# π’΅λ™μ‹μ„± μ μ–΄ λ°©μ‹ 

## 1. λ™μ‹μ„± μ μ–΄μ ν•„μ”μ„±
λ™μ‹μ— ν¬μΈνΈλ¥Ό μ¶©μ „ν•κ±°λ‚ μ‚¬μ©ν•λ” μƒν™©μ—μ„ λ™μ‹μ„± μ μ–΄λ¥Ό μ μ ν ν•μ§€ μ•μΌλ©΄ λ‹¤μκ³Ό κ°™μ€ λ¬Έμ κ°€ λ°μƒν•  μ μμµλ‹λ‹¤.
- **λ°μ΄ν„° λ¶μΌμΉ**: λ™μ‹μ— μ—¬λ¬ μ‘μ—…μ΄ μν–‰λ  λ•, λ°μ΄ν„°λ² μ΄μ¤μ μƒνƒκ°€ μΌκ΄€λμ§€ μ•μ„ μ μμµλ‹λ‹¤.
- **μ •ν•©μ„± λ¬Έμ **: ν¬μΈνΈ μ¶©μ „ λλ” μ‚¬μ© λ‚΄μ—­μ΄ μ¬λ°”λ¥΄κ² κΈ°λ΅λμ§€ μ•κ±°λ‚, ν¬μΈνΈ μ”μ•΅μ΄ μλ» κ³„μ‚°λ  μ μμµλ‹λ‹¤.
- **ν¬μΈνΈ μ”μ•΅ μ΄κ³Ό μ‚¬μ©**: λ™μ‹μ— ν¬μΈνΈλ¥Ό μ‚¬μ©ν•  κ²½μ°, ν¬μΈνΈ μ”μ•΅μ΄ μ¶©λ¶„ν•μ§€ μ•μμ—λ„ λ¶κµ¬ν•κ³  ν¬μΈνΈκ°€ μ¤‘λ³µμΌλ΅ μ‚¬μ©λ  μ μμµλ‹λ‹¤.

μ΄λ¥Ό λ°©μ§€ν•κΈ° μ„ν•΄ λ‹¤μκ³Ό κ°™μ€ λ°©μ‹μΌλ΅ λ™μ‹μ„± μ μ–΄λ¥Ό ν•μ€μµλ‹λ‹¤.

## 2. μ‚¬μ©λ λ™μ‹μ„± μ μ–΄ λ°©μ‹
λ³Έ ν”„λ΅μ νΈμ—μ„λ” ReentrantLockμ„ μ‚¬μ©ν•μ—¬ λ™μ‹μ„±μ„ μ μ–΄ν•μ€μµλ‹λ‹¤.

### 2.1. ReentrantLock
- **μ‚¬μ© μ΄μ **: μλ°”μ `synchronized` ν‚¤μ›λ“λ³΄λ‹¤ μ μ—°ν•κ² λ™μ‘ν•  μ μμΌλ©°, λ…μ‹μ μΌλ΅ μ κΈκ³Ό ν•΄μ λ¥Ό μ μ–΄ν•  μ μμµλ‹λ‹¤.
- **λ™μ‘ μ›λ¦¬**: νΉμ • μ‚¬μ©μκ°€ ν¬μΈνΈλ¥Ό μ¶©μ „ν•κ±°λ‚ μ‚¬μ©ν•  λ•, `ReentrantLock`μ„ ν†µν•΄ ν•΄λ‹Ή μ‘μ—…μ„ λ‹¨μΌ μ¤λ λ“μ—μ„λ§ μ²λ¦¬ν•  μ μλ„λ΅ ν•μ—¬ λ™μ‹μ— μ—¬λ¬ μ¤λ λ“κ°€ λ™μΌν• μμ›(ν¬μΈνΈ μ”κ³ )μ— μ ‘κ·Όν•λ” κ²ƒμ„ λ°©μ§€ν•©λ‹λ‹¤.
- μ‚¬μ© μμ‹
  ```java
  private final Lock lock = new ReentrantLock();
  
  public UserPoint transaction(long id, long amount, TransactionType type) {
    lock.lock();
    try {
      // νΈλμ­μ… λ΅μ§
    } finally {
      lock.unlock();
    }
  }
  ```
### 2.2 `ReentrantLock` vs `synchronized`

| νΉμ„±                         | `ReentrantLock`                                                                        | `synchronized`               |
|------------------------------|----------------------------------------------------------------------------------------|------------------------------|
| **λ½ νλ“κ³Ό ν•΄μ **           | λ…μ‹μ (lock()/unlock())<br/>- μ‹μ‘κ³Ό λμ„ λ…μ‹ν•κΈ° λ•λ¬Έμ— μ—¬λ¬ λ©”μ„λ“μ— λ‚λ μ„ μ‘μ„± κ°€λ¥        | μ•”μ‹μ (λΈ”λ΅μ΄ λλ‚  λ• μλ™ ν•΄μ )<br/>- λ©”μ„λ“ μ•μ— μ„κ³„ μμ—­μ μ‹μ‘κ³Ό λμ΄ μ΅΄μ¬ |
| **κ³µμ •μ„± μ„¤μ •**              | `Fair` λ¨λ“λ¥Ό μ‚¬μ©ν•μ—¬ κ³µμ •μ„± λ³΄μ¥ κ°€λ¥ <br/> - κ³µμ •ν• lockμ„ μ‚¬μ©ν•  κ²½μ° κ²½μμ΄ λ°μƒν–μ„ λ• κ°€μ¥ μ¤λ«λ™μ• κΈ°λ‹¤λ¦° μ“°λ λ“μ—κ² lockμ„ μ κ³µ | λ¶κ°€λ¥                          |
| **λ½μ μƒνƒ ν™•μΈ**           | `isLocked()`, `isHeldByCurrentThread()` λ“±μ„ ν†µν•΄ μƒνƒ ν™•μΈ κ°€λ¥                                 | λ¶κ°€λ¥                          |
| **μ΅°κ±΄ λ³€μ**                | μ—¬λ¬ `Condition` κ°μ²΄λ¥Ό μ‚¬μ©ν•  μ μμ.                                                           | λ‹¨μΌ μ΅°κ±΄ λ³€μ(μ•”μ‹μ )                |
| **μ„±λ¥**                     | λ†’μ€ μμ¤€μ μ μ–΄λ΅ λ” λ†’μ€ μ„±λ¥ μ κ³µ κ°€λ¥ (λ…μ‹μ  μ μ–΄)                                                      | κ°„λ‹¨ν• λ™κΈ°ν™”μ— λ” μ ν•© (μ•”μ‹μ  μ μ–΄)       |

- `ReentrantLock`μ€ `synchronized`μ™€ λΉ„κµν•μ—¬ λ‹¤μκ³Ό κ°™μ€ μ¥μ μ„ κ°€μ§‘λ‹λ‹¤:
  - **κ³µμ •μ„±(Fairness) μ„¤μ •**: `ReentrantLock`μ€ κ³µμ •μ„± μ„¤μ •μ΄ κ°€λ¥ν•μ—¬, λ€κΈ° μ¤‘μΈ μ¤λ λ“κ°€ λ½μ„ κ³µμ •ν•κ² νλ“ν•  μ μμµλ‹λ‹¤.
  - **λ” λ§μ€ μ μ–΄**: `ReentrantLock`μ€ `lock()`κ³Ό `unlock()` λ©”μ„λ“λ¥Ό μ‚¬μ©ν•΄ λ½μ„ λ…μ‹μ μΌλ΅ μ μ–΄ν•  μ μμ–΄, λ³µμ΅ν• λ½ ν•΄μ  λ΅μ§μ„ κµ¬ν„ν•  μ μμµλ‹λ‹¤.
  - **μ΅°κ±΄ λ³€μ(Condition Variables)**: `ReentrantLock`μ€ `Condition` κ°μ²΄λ¥Ό ν†µν•΄ μ„Έλ°€ν• μ΅°κ±΄ λ™κΈ°ν™”λ¥Ό μ§€μ›ν•©λ‹λ‹¤.
- λ‹¨, κ°„λ‹¨ν• λ™κΈ°ν™”μ κ²½μ° `synchronized` ν‚¤μ›λ“κ°€ λ” κ°„κ²°ν•κ³  μ΄ν•΄ν•κΈ° μ‰¬μ΄ μ¥μ μ„ κ°€μ§€κ³  μμΌλ―€λ΅, μƒν™©μ— λ”°λΌ μ μ ν• λ°©μ‹μ„ μ„ νƒν•΄μ•Ό ν•©λ‹λ‹¤.

### 2.3. `CompletableFuture`λ¥Ό μ΄μ©ν• λΉ„λ™κΈ° ν…μ¤νΈ
- **μ‚¬μ© μ΄μ **: λΉ„λ™κΈ°μ μΌλ΅ μ—¬λ¬ μ¤λ λ“κ°€ λ™μ‹μ— μ‘μ—…μ„ μ”μ²­ν•λ” μ‹λ‚λ¦¬μ¤λ¥Ό ν…μ¤νΈν•κΈ° μ„ν•΄ μ‚¬μ©ν•©λ‹λ‹¤.
- **λ™μ‘ μ›λ¦¬**: μ—¬λ¬ κ°μ `CompletableFuture` μ‘μ—…μ„ μƒμ„±ν•κ³ , `allOf()` λ©”μ„λ“λ¥Ό ν†µν•΄ λ¨λ“  μ‘μ—…μ΄ λ™μ‹μ— μ‹¤ν–‰λλ„λ΅ ν•©λ‹λ‹¤. μ΄λ ‡κ² ν•¨μΌλ΅μ¨ λ‹¤μμ μ‚¬μ©μ μ”μ²­μ΄ λ™μ‹μ— λ“¤μ–΄μ¤λ” μƒν™©μ„ μ‹λ®¬λ μ΄μ…ν•  μ μμµλ‹λ‹¤.
- μ‚¬μ© μμ‹
  ```java
  CompletableFuture<Void> future1 = CompletableFuture.runAsync(() -> {
      pointService.transaction(user1Id, 1000, TransactionType.CHARGE);
  });
  
  CompletableFuture<Void> future2 = CompletableFuture.runAsync(() -> {
      pointService.transaction(user2Id, 1000, TransactionType.USE);
  });
  
  CompletableFuture.allOf(future1, future2).join();
  ```

## 3. ν…μ¤νΈ λ° κ²€μ¦
λ™μ‹μ„± μ μ–΄κ°€ μ λ€λ΅ λ™μ‘ν•λ”μ§€ κ²€μ¦ν•κΈ° μ„ν•΄ λ‹¤μκ³Ό κ°™μ€ ν…μ¤νΈλ¥Ό μν–‰ν•μ€μµλ‹λ‹¤:

1. **λ™μ‹ ν¬μΈνΈ μ¶©μ „ ν…μ¤νΈ**: μ‚¬μ©μκ°€ λ™μ‹μ— ν¬μΈνΈλ¥Ό μ¶©μ „ν•  λ•, μ΄ ν¬μΈνΈκ°€ μ •ν™•ν•κ² μ¦κ°€ν•λ”μ§€ ν™•μΈν•μ€μµλ‹λ‹¤.
2. **λ™μ‹ ν¬μΈνΈ μ‚¬μ© ν…μ¤νΈ**: μ‚¬μ©μκ°€ λ™μ‹μ— ν¬μΈνΈλ¥Ό μ‚¬μ©ν•  λ•, ν¬μΈνΈ λ¶€μ΅± μ‹ μμ™Έκ°€ λ°μƒν•λ”μ§€ ν™•μΈν•μ€μµλ‹λ‹¤.
3. **λ™μ‹ ν¬μΈνΈ μ¶©μ „/μ‚¬μ© νΌν•© ν…μ¤νΈ**: μ‚¬μ©μκ°€ λ™μ‹μ— ν¬μΈνΈ μ¶©μ „κ³Ό μ‚¬μ©μ„ νΌν•©ν•μ—¬ μ”μ²­ν•  λ•, μμ„λ€λ΅ μ²λ¦¬λλ”μ§€ ν™•μΈν•μ€μµλ‹λ‹¤.
4. **λ™μ‹μ— ν¬μΈνΈ μ¶©μ „ μ”μ²­ ν•λ„ μ΄κ³Όλ΅ μ‹¤ν¨**: ν¬μΈνΈ μ¶©μ „μ‹ ν¬μΈνΈ ν•λ„κ°€ μ΄κ³Όλ  κ²½μ°, ν•λ„ μ΄λ‚΄μ—μ„ μ¶©μ „μ΄ μ™„λ£ λλ”μ§€ ν™•μΈν•μ€μµλ‹λ‹¤.
5. **λ™μ‹μ— ν¬μΈνΈ μ‚¬μ© μ”μ²­μ‹ μ”μ•΅ λ¶€μ΅±μΌλ΅ μ‹¤ν¨**: ν¬μΈνΈ μ‚¬μ©μ‹ μ”μ•΅μ΄ λ¶€μ΅±ν• κ²½μ°, μ‚¬μ©λμ§€ μ•λ”μ§€ ν™•μΈν•μ€μµλ‹λ‹¤.

## 4. κ²°λ΅ 
`ReentrantLock`μ„ ν†µν•΄ λ™μ‹μ„± μ μ–΄λ¥Ό κµ¬ν„ν•μ€μΌλ©°, ν…μ¤νΈλ¥Ό ν†µν•΄ μ΄λ¥Ό κ²€μ¦ν•μ€μµλ‹λ‹¤. `synchronized` λ³΄λ‹¤ κ³µμ •μ„± μκ³ , λ…μ‹μ μΌλ΅ μ„Έλ°€ν• μ μ–΄κ°€ κ°€λ¥ν•λ‹¤λ” κ²ƒμ„ μ• μ μμ—μµλ‹λ‹¤. ν…μ¤νΈ μ½”λ“λ¥Ό ν†µν•μ—¬ μ •ν•©μ„± λ¬Έμ , μ •μ±…(μ”κ³ λ¶€μ΅±, μµλ€μ”κ³ ) λ¬Έμ  λ“±μ— λ€ν•΄ λ¬Έμ κ°€ λ°μƒν•μ§€ μ•λ”μ§€ ν™•μΈν•  μ μμ—μµλ‹λ‹¤.